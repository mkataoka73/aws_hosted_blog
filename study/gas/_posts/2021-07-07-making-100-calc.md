---
layout: post
title: GASで100マス計算を作る
hero: https://source.unsplash.com/rD2dc_2S3i0/800x600
permalink: gas-100-calc
published: false
---

自分の勤めている塾では、小学校高学年から高卒生まで、勉強に悩みや課題を抱えている生徒さんを幅広く受け入れています。

小学生のお子さんの場合は、「計算速度が遅い」というお悩みを抱えてらっしゃる親御さんも多くいらっしゃいます。

計算速度をあげるのに有効なものとして、しばしば100マス計算があげられます。

当塾にも紙媒体のドリルが1冊、置いてありました。

しかし、同じ問題をいつもやっていると、「答えを覚えてしまう」という声があがることがあります。

本当はそれでもいいのかもしれませんが（例えば9+7=16であると覚えてしまうと計算が速くなる）、計算の組み合わせをランダムにできるのも、それはそれで利点だろうと思いました。

100マス計算は表計算ソフトで簡単につくれます。横と縦に、0から9の数字をランダムに並べるだけです。

ボタンを押したら、ランダムに100マス計算の問題を作ってくれるコードをGASで書いたら…と思いました。

例えばこんな配列を用意します。

```js
const numbers = [0,1,2,3,4,5,6,7,8,9];
```

そして、縦用と横用に、それぞれランダムに並び替えた新しい配列を用意するのがよさそうです。

JavaScriptには配列をシャッフルするビルトインメソッドはないので、[このサイト](https://www.nxworld.net/js-array-shuffle.html)に載っていたものを拝借することにします（少し簡単にしています）。


```js
function shuffle(array) {
  for (let i = array.length - 1; i >= 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// まだ完成形ではありません
const numbersForRow = shuffle(numbers);
const numbersForCol = shuffle(numbers);
```

ここで少々問題があります。

GASでスプレッドシートに書き込みをする際、データは1行を1つの配列とした**2次元配列**として用意する必要があるのです。

分かりにくいので実際にコードで表現してみましょう。

### 横

まず横並びの数字はこうです。0から9の数字が入った配列を、さらに配列の中に入れます。

```js
const numbersForRow = [shuffle(numbers)];
// [ [
//     3, 2, 1, 6, 0,
//     7, 9, 5, 8, 4
//   ] ]
```

<!-- {% include image.html url="/assets/images/numbers-for-row.40.36.png" description="numbers-for-row" class="large" %} -->

配列の中に配列が入っているのがお分かりいただけるでしょうか。

これで横に並べる数列は完成しました。

### 縦

縦並びにする数字の列はもう一段複雑です。

というのは、縦に10行ならべる場合、**ひとつひとつの数字を全て配列に包む** 必要があるからです。

先ほど二次元配列について、「一つの行を一つの配列と見立てる」と説明申し上げたのを覚えておいででしょうか。

数字を縦に並べる場合は 1列の数字が10行並んでいるので、**数字が一つだけ入った配列を10個用意し、それをまた一つ大きな配列で囲む** ことになります。

コードで表現するとこうです（簡便のため順序は入れ替えていません）。

```js
[[0],[1],[2],[3],[4],[5],[6],[7],[8],[9]];
```

これを`shuffle`したものが、目指すべき配列となります。

```js
shuffle([[0],[1],[2],[3],[4],[5],[6],[7],[8],[9]]);
// [
//   [ 3 ], [ 0 ], [ 4 ],
//   [ 1 ], [ 6 ], [ 2 ],
//   [ 5 ], [ 9 ], [ 8 ],
//   [ 7 ]
// ]
```

私たちには、ただの数字の配列`numbers`が用意されています。

```js
const numbers = [0,1,2,3,4,5,6,7,8,9];
```

これを上の`numbersForCol`の形にするにはどうすればいいでしょう？

### map

JavaScriptには便利な`map`という関数があります。これは、配列の各要素に対して、同一処理をするための関数です。

例を見てみましょう。

1から5を順に並べた数字の配列があるとします。

```js
[1,2,3,4,5]
```

この配列の各要素に2をかけて、`[2,4,6,8,10]`を得たいとします。その時、`map`を使うと、次のように書けます。

```js
[1,2,3,4,5].map(number => number * 2);
// [ 2, 4, 6, 8, 10 ]
```

私たちの状況でも、これを使うと良さそうです。

1. `numbers`内の数字を一つずつ、配列の中に格納する
2. それらの順番をランダム化する

これをコードで実現してみましょう。

```js
const numbersForCol = shuffle(numbers.map(number => [number]));
// [
//   [ 3 ], [ 0 ], [ 4 ],
//   [ 1 ], [ 6 ], [ 2 ],
//   [ 5 ], [ 9 ], [ 8 ],
//   [ 7 ]
// ]
```

これで良さそうです！

あとは、スプレッドシートにこれらのデータを書き込めばいいですね。

```js
const sheet = SpreadsheetApp.getActiveSheet();

sheet.getRange('A2:J12').setValues(numbersForRow);
sheet.getRange('B1:J1').setValues(numbersForCol);
```

完成です！

## まとめ
{:.h2}

GASで100マス計算を作ることを通して、JavaScriptの関数や配列の操作を見てきました。

みなさんのGAS理解の一助になれば幸いです。Happy Coding!
